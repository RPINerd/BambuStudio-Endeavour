ARG VERSION="studio_dep_arch"
FROM ${VERSION}:1.0 AS builder

COPY ./ /BambuStudio

WORKDIR /BambuStudio

RUN mkdir -p /BambuStudio/deps/build

# Bring in prebuilt deps from the Arch deps image
RUN mv /destdir /BambuStudio/deps/build/

# Build BambuStudio itself
RUN ./BuildLinux.sh -s

# Generate AppImage (container awareness is used by the script)
ENV container=podman
RUN ./BuildLinux.sh -i

FROM scratch AS export-stage

# Copy any produced AppImage (name may vary across distros)
COPY --from=builder /BambuStudio/build/*.AppImage /
